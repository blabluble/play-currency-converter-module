<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Play Currency Converter by edulify</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Play Currency Converter</h1>
        <p class="header">This is a play module for currency conversion</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-currency-converter-module.edulify.com/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-currency-converter-module.edulify.com/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/edulify/play-currency-converter-module.edulify.com">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/edulify">edulify</a></p>


      </header>
      <section>
        <h1>
<a name="play-currency-converter-module" class="anchor" href="#play-currency-converter-module"><span class="octicon octicon-link"></span></a>play-currency-converter-module</h1>

<p>This is a play module for currency conversion. The current version (1.1.5) is compatible with play-2.2. For compatibility with play version 2.1.x use the module version 1.1.4.</p>

<p>Currently, the module is using the <a href="http://www.getexchangerates.com/">Get Exchange Rates</a> service to made the conversion.</p>

<h2>
<a name="configuring" class="anchor" href="#configuring"><span class="octicon octicon-link"></span></a>Configuring</h2>

<p>The first step is include the currency converter in your dependencies list, in <code>Build.scala</code> file:</p>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">sbt._</span>
<span class="k">import</span> <span class="nn">Keys._</span>
<span class="k">import</span> <span class="nn">play.Project._</span>

<span class="k">object</span> <span class="nc">ApplicationBuild</span> <span class="k">extends</span> <span class="nc">Build</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">appName</span>         <span class="k">=</span> <span class="s">"currency-converter-sample"</span>
  <span class="k">val</span> <span class="n">appVersion</span>      <span class="k">=</span> <span class="s">"1.0-SNAPSHOT"</span>

  <span class="k">val</span> <span class="n">appDependencies</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="c1">// Add your project dependencies here,</span>
    <span class="n">javaCore</span><span class="o">,</span>
    <span class="n">javaJdbc</span><span class="o">,</span>
    <span class="n">javaEbean</span><span class="o">,</span>
    <span class="s">"com.edulify"</span> <span class="o">%</span> <span class="s">"currency-converter_2.10"</span> <span class="o">%</span> <span class="s">"1.1.6"</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="n">main</span> <span class="k">=</span> <span class="n">play</span><span class="o">.</span><span class="nc">Project</span><span class="o">(</span><span class="n">appName</span><span class="o">,</span> <span class="n">appVersion</span><span class="o">,</span> <span class="n">appDependencies</span><span class="o">).</span><span class="n">settings</span><span class="o">(</span>
    <span class="c1">// Add your own project settings here</span>
    <span class="n">resolvers</span> <span class="o">+=</span> <span class="nc">Resolver</span><span class="o">.</span><span class="n">url</span><span class="o">(</span><span class="s">"Edulify Repository"</span><span class="o">,</span> <span class="n">url</span><span class="o">(</span><span class="s">"http://edulify.github.io/modules/releases/"</span><span class="o">))(</span><span class="nc">Resolver</span><span class="o">.</span><span class="n">ivyStylePatterns</span><span class="o">)</span>
  <span class="o">)</span>

<span class="o">}</span>

</pre></div>

<p>Don't forget to add the resolver to your list of resolvers, or it won't work!</p>

<h3>
<a name="caching" class="anchor" href="#caching"><span class="octicon octicon-link"></span></a>Caching</h3>

<p>This module saves a cache of the request made for the service. The default cache time to live is 60 seconds, but this time can be changed using the method <code>setCacheTime(long seconds)</code>.</p>

<p>Also, you can set cache off, by calling the method <code>useCache(false)</code>. <strong>Warning</strong>: by setting off the cache, you can overload your system (and the service) due to multiple requests. Without cache activated, every call to Converter.convert will make a request to the choosen web service.</p>

<h4>
<a name="caching-auto-update-job-optional" class="anchor" href="#caching-auto-update-job-optional"><span class="octicon octicon-link"></span></a>Caching auto-update job (optional)</h4>

<p>In order to keep your cache always updated, you can create a background job to auto-update in frequent intervals (based on <em>time to live</em> of the cache). To do this, there are three simple steps to follow:</p>

<ul>
<li>Start the job inside the <code>Global</code> class:</li>
</ul><div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">play.Application</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.GlobalSettings</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.edulify.modules.currency.ConverterCacheJob</span><span class="o">;</span>

<span class="nd">@SuppressWarnings</span><span class="o">({</span> <span class="s">"unchecked"</span><span class="o">,</span> <span class="s">"rawtypes"</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Global</span> <span class="kd">extends</span> <span class="n">GlobalSettings</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">(</span><span class="n">Application</span> <span class="n">app</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">ConverterCacheJob</span><span class="o">.</span><span class="na">startConverterCacheUpdate</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<ul>
<li>Set up your <code>Global</code> class in your <code>application.conf</code>:</li>
</ul><pre><code># Global object class
# ~~~~~
# Define the Global object class for this application.
# Default to Global in the root package.
application.global=Global
</code></pre>

<ul>
<li>Set the name for the dispatcher that will do this job (also in the <code>application.conf</code> file):</li>
</ul><pre><code>converter.dispatcher.name = "converter"
</code></pre>

<h3>
<a name="precision" class="anchor" href="#precision"><span class="octicon octicon-link"></span></a>Precision</h3>

<p>By default, the module makes operations using a precision of 100 decimals. You can change this value using the method <code>setPrecision(int precision)</code>. <strong>Warning</strong>: Low precisions can result in wrong conversions. Change it carefully.</p>

<h3>
<a name="global-configurations" class="anchor" href="#global-configurations"><span class="octicon octicon-link"></span></a>Global configurations</h3>

<p>These configurations (about caching and precision) can also be setted globally in the <code>application.conf</code> file, using the following keys:</p>

<pre><code>converter {
  cacheTTL  = 600
  useCache  = true
  precision = 100
}
</code></pre>

<p>or</p>

<pre><code>converter.cacheTTL  = 10
converter.useCache  = true
converter.precision = 100
</code></pre>

<h2>
<a name="using" class="anchor" href="#using"><span class="octicon octicon-link"></span></a>Using</h2>

<p>To use this module, its enough to import it in your class and use the static method <code>Converter.convert</code>:</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">com.edulify.modules.currency.Converter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">BigDecimal</span> <span class="n">convertedValue</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="mf">199.0</span><span class="o">),</span> <span class="s">"EUR"</span><span class="o">,</span> <span class="s">"USD"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvalidCurrencyException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CommunicationErrorException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>This method, as shown in the example, should raise two exceptions:</p>

<ul>
<li>
<code>InvalidCurrencyException</code>: thrown when the currency code is not valid for the service.</li>
<li>
<code>CommuncationErrorException</code>: thrown when the service returns an invalid json.</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
